{% extends 'base.html' %} {% block content %} {% load static %}
<!-- Show user account info if logged in -->
<div id="loginApp">
	{% csrf_token %}
	<div v-if="user" class="container">
		<div class="row">
			<div class="col-md-12">
				<h1>Account</h1>
			</div>
		</div>
	</div>

	<!-- Show login form if not logged in -->
	<div v-else>
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<h1>Login</h1>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="row">
				<div
					class="col-md-12 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-10 col-xs-offset-1"
				>
					<!-- Login form -->
					<form
						action="{% url 'users:login' %}"
						method="POST"
						class="auth-form"
					>
						<!-- Render error messages if they exist -->
						{% if error%}
						<h3 class="error">{{error}}</h3>
						{% endif%} {% csrf_token %}
						<label for="username-field">Username</label>
						<input type="text" name="username" id="username-field" />

						<label for="password-field">Password</label>
						<input type="password" name="password" id="password-field" />

						<button>Submit</button>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	window.onload = function () {
		const BASE_URL = "{% url 'users:account' %}";
		const csrfToken = document.getElementsByName("csrfmiddlewaretoken")[0];
		console.log(BASE_URL);
		console.log(csrfToken.value);
		axios.defaults.xsrfHeaderName = "X-CSRFToken";
		axios.defaults.headers = {
			"Content-Type": "application/json",
			"X-CSRFToken": csrfToken.value,
		};

		const app = new Vue({
			delimiters: ["[[", "]]"],
			el: "#loginApp",
			data: {
				user: {
					username: "{{user.username}}",
					email: "{{user.email}}",
					first_name: "{{user.first_name}}",
					last_name: "{{user.last_name}}",
					id: "{{user.id}}",
				},
				created: function () {
					axios({
						method: "GET",
						url: BASE_URL,
					})
						.then((response) => {
							this.user = response.data;
						})
						.catch((error) => {
							console.log(error);
						});
				},
			},
		});
	};
</script>

{% endblock content %}
